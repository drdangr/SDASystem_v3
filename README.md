# Story Driven Analytical System  
*Concept Document v0.2*

---

## Введение

Этот документ описывает концепцию **Story Driven аналитико-информационного инструмента**, цель которого — формировать Сюжеты (stories) на основе:

1. **Графа Новостей** -  (контентный слой) -  постов, новостей, заметок.  
2. **Графа Акторов** - (NER слой) — людей, компаний, стран, организаций и др., извлекаемых через NER и редакторскую курацию.  

Оба слоя объединяются в **двухуровневый граф**, из которого формируются кластеры — кандидаты в Сюжеты. 

Кандидаты в Сюжеты обновляются автоматически, редактор может закрепить,     кандидата, а так же редактировать, объединять, разделять их.

---

## 1. Двухуровневая структура данных

### 1.1. Слой 1: Новости (Documents Layer)
- Узлы: Новости (посты / новостийные заметки / публикации).  
- Связи: семантическая близость (эмбеддинги), редакторские «связано/не связано».  
- Метрики: косинусная близость, время публикации, домены.  

Узлы Новостей автоматически кластеризуются по семантической близости, редактор может динамически управлять процессом кластеризации, путем усиления или ослабления связи ребер, и изменения масштаба кластеризации, а так же объединять, разделять кандидатов в Сюжеты.

Выделив любую ноду Новостей, можно ее двигать по графу, и при этом видеть связанные с ней ноды Новостей, а так же связанные с ней ноды Акторов.

Кроме этого можно усилить или ослабить связь со свзянными с ней нодами, чтобы они подтянулись поближе и иметь возможность сразу визуально оценить взаимосвязи и кандидатов на кластеризацию в Сюжет.

### 1.2. Слой 2: Акторы (Actors Layer)
- Узлы: акторы (NER: персоны, компании, страны, организации, структуры, события).  
- Связи: `member_of`, `ally_of`, `competitor_of`, `part_of`, `operates_in`, `role_in`, `regulates`, `owns`.  
- Метрики: частота упоминаний, тип связи, доверие, временные рамки.

### 1.3. Перекрёстные связи
- Рёбра `post ↔ actor`: упоминание актора в посте, с атрибутами (роль, контекст, уверенность).  

### 1.4. Общиий вид графа
- Слой Новостей: Ближайшая аналогия — это космос. В нем есть планеты, звезды, кометы, астероиды, а так же связи между ними. 
Роль планет испольняют Новости, которые расолагаются общего центра масс - кластера-Сюжета, исполняющего роль звезды. 

Сюжеты - звезды собираются в скопления - Домены, образующие собственную иерархию (политика, экономика, культура и др.) Домены так же могут быть связаны между собой и имеют собственную иерархию (авмобили -> транспорт -> техника -> экономика, либо нейросети -> искусственный интеллект -> технологии -> экономика, либо лекарства -> медицина -> здоровье -> культура, или война в Украине -> Военные действия -> политика)

При этом допускаются как вертикальные, так и горизонтальные связи на всех уровнях - между Новостями, Сюжетами, поддоменами и Доменами.

- Слой Акторов: второй слой графа, при этом связи между Акторами и Новостями, не влияют на кластеризацию Новостей в Сюжеты, и слжат для визуального представления взаимосвязей между Новостями и Акторами.

---

## 2. Автоматическое формирование

### 2.1. Новости
- Эмбеддинг текста (summary + ключевые сущности).  
- Метаданные: время публикации, источник, автор, связанные акторы, связанные под-домены. 
- Дедубликация новостей (репосты). 

### 2.2. Сюжеты
- Склейка (Кластеризация) новостей и формирование кандидатов на Сюжеты: 
    - по связям по косинусной близости (HDBSCAN / kNN-граф),  
    - по общим акторам (shared actors → bonus к близости)
    - правка редактором
 - Создание текста Сюжета на основе саммари новостей, связанных с этим Сюжетом.

### 2.2. Акторы
- Извлечение NER (модель + газеттир).  
- Канонизация через словарь (`canonical_name`, алиасы).  
- Автогенерация связей по паттернам: «министр X → member_of Government», «подразделение Y → part_of Holding Z».  
- Событийные связи (ephemeral): «X раскритиковал Y», TTL 30–90 дней.
- Различаются персоны и организации

### 2.2. События и Таймлайн
- Если в новости есть упоминание времени, то из нее извлекается событие на таймлайн. Может быть двух типов: факт(точное описание события из ловерительного источника) и мнение(высказанное отношение к событию важного актора). Раличаются семантически, но визуально выделяются разными цветами. 
- в рамках одного Сюжета на таймлайн собираются все события, извелеченные из всех новостей, связанных с этим Сюжетом.

---

## 3. Редакторская работа

### 3.1. Сюжеты
- Ручная редактура текста Сюжета. 
- Ручное изменение метаданных Сюжета.
- Ручное объединение нескольких Сюжетов в один.
- Merge / Split новостей в Сюжеты. 
- Ручное связывание не связанных новостей с Сюжетом. 
- Исключение новости из Сюжета.  
- Ручная пометка связности/несвязности (overrides автоматики). 
- Pin новости как ядро Сюжета. 
- Управление связями (добавить `competitor_of`, `ally_of`).
- Управление событиями (удалить, изменить тип, изменить дату, изменить источник, добавить связь). 
- Управление Акторами (удалить, изменить тип, изменить источник, добавить связь). 

### 3.2. Акторы
- Создать актора.  
- Добавить/удалить алиас, прозвище, эвфемизм.  
- Merge / Split акторов.  
- Правка канона, типа, статуса.  
- Управление связями (добавить `competitor_of`, `ally_of`).  
- Массовые правки (CSV импорт/экспорт).  

### 3.3. Эффект на сюжеты
- Любая правка в слое постов или акторов пересчитывает сюжеты.  
- Merge акторов → объединение сюжетов, где они ключевые.  
- Split актора → потенциальное расщепление сюжетов.  
- Новая связь между акторами → пересмотр merge-кандидатов среди сюжетов.  

---

## 4. UI принципы

### 4.1. Stories UI
- **Список сюжетов** с метриками: relevance, cohesion, size, freshness. 
- **Граф** новостей/акторов, образующий кластеры Сюжетов, разделенные на домены. 
- **Карточка сюжета**: заголовок, буллеты, топ-акторы, источники, связанные под-домены.  
- **Таймлайн**: факты (голубые), мнения (оранжевые).  
- Кнопки: merge, split, edit для выбранных событий. 
- Кнопки масштаба: autozoom, zoom in, zoom out, day/week/month/year

### 4.2. Actors UI
- **Карточка актора**: 
- Основная информация: имя, тип, тренды упоминаний, топ-домены.  
- Вкладка «Алиасы»: surface forms, тип (nickname, typo).  
- Вкладка «Mentions»: свежие упоминания, быстрые действия (✓ подтвердить, ✗ отклонить).  
- Вкладка «Связи»: мини-граф (`ally_of`, `competitor_of`, `member_of`).    

### 4.3. Связанность
#### 4.3.1 Общий принцип: 
Все панели связаны: действие на одном уровне отражается в другом. 
В целом функционал панелей таков:
- Левая панель отображает заголовки сюжетов (в режме списка) или ноды (в режме графа).
- Средняя панель отображает детальную карточку сюжета: его заголовок, буллеты, текст, топ-акторы, связанные под-домены, перечень входящих в него новостей и всех остальных акторов, упомянутых в новостях, связанных с ним.
- Правая панель отображает детали выбранной в средней панели новости или актора.
- Таймлайн в нижней панели отображает факты (голубые) и мнения (оранжевые) для выбранного в средней панели сюжета.
#### 4.3.2 Механика взаимодействия:
- В левой панели заголовки сюжетов в режме списка или ноды в режме графа: при клике на заголовок сюжета в среднюю панель загружается карточка Сюжета.
- В средней панели в карточке сюжета виден список акторов, и новости, связанные с ним.
- При клике на актора в средней панели в правой панели загружается карточка актора.
- При клике на новость в средней панели в правой панели загружается карточка новости.
- В правой панели, в карточке актора → список новостей и сюжетов, где он участвует. 
- В правой панели, в карточке новости → список акторов, упомянутых в ней. 
- Все панели связаны: действие на одном уровне отражается в другом.  

---

## 5. Перестройка и живучесть сюжетов

- Сюжет = **динамический кластер**.  
- Метрика `relevance` определяет, насколько он «актуален».  
- Сюжет угасает при тишине, но всплывает, если появляется новое значимое событие.  
- Важные события определяются по доверительным источникам, всплескам активности или критическим акторам.  
- Акторы придают структуру: объединяют сюжеты, уточняют границы, помогают редактору ориентироваться.  

---

## Итог

Получается единая система:  

- **Новости**: посты, новости, заметки.  
- **Акторы**: люди, компании, страны, структуры.  
- **Двухуровневый граф**: новости ↔ акторы, с семантическими и ролевыми связями.  
- **Кластеры-Сюжеты**: формируются автоматически и корректируются редактором → становятся сюжетами.  
- **UI**: четыре модуля — список сюжетов, карточка сюжета, карточка актора, таймлайн. Всё связано и перестраивается автоматически.  

Цель: не просто выдавать дайджест, а строить **структурированное понимание ситуации**: активные сюжеты, их история, акторы и связи, спектр мнений, прогнозы и последствия.  
