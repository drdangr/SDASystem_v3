# Roadmap & Progress Checklist

Документ для отслеживания прогресса по этапам и задачам.  
Формат: отмечаем `[x]` для выполненного, `[ ]` для невыполненного.  
Агент при каждой итерации:
- Проверяет верхнеуровневые этапы и подзадачи.
- Обновляет чекбоксы по факту выполнения.
- Кратко фиксирует датой/комментарием, что сделано (в скобках).
- Не редактирует историю планов, только состояние чекбоксов и комментарии.

## Этап 1. Полное покрытие концепции на мок-данных (выполнено 2025-12-06)
- [x] Задача 1.1 Таймлайн и события (2025-12-06: генерация в `load_data`, UI состояния/цвета/зум)
  - [x] Подзадача 1.1.1 Генерация событий при загрузке мок-данных (`load_data` + `EventExtractionService`)
  - [x] Подзадача 1.1.2 Фолбэк дат на `published_at`, поддержка RU/EN паттернов
  - [x] Подзадача 1.1.3 UI: состояния загрузка/пусто/ошибка, цвета fact/opinion, зум-кнопки
- [ ] Задача 1.1.A Доработка таймлайна (замечание)
  - [ ] Подзадача 1.1.A.1 Редизайн таймлайна (выравнивание тиков/пинов, компактный вид как в референсе)
  - [ ] Подзадача 1.1.A.2 Отделить сглаженные/жёсткие зумы, корректное позиционирование меток
  - [ ] Подзадача 1.1.A.3 Привести цвета/размеры в соответствии с минималистичным гайдлайном
- [x] Задача 1.2 Сюжеты: список/граф (2025-12-06: метрики+домены в UI, панели/resizer стабильны)
  - [x] Подзадача 1.2.1 Метрики relevance/cohesion/size/freshness в UI
  - [x] Подзадача 1.2.2 Домены/поддомены в списке и карточке
  - [x] Подзадача 1.2.3 Панели/resizer, сохранение состояний в localStorage (проверено)
- [x] Задача 1.3 Детали сюжета (2025-12-06: буллеты, акторы, новости, события)
  - [x] Подзадача 1.3.1 Буллеты, топ-акторы, связанные новости
  - [x] Подзадача 1.3.2 Отображение событий сюжета (таймлайн)
- [x] Задача 1.4 Детали новости/актора (2025-12-06: акторы/related/mentions/relations)
  - [x] Подзадача 1.4.1 Новости: акторы, related (минимум базовые данные)
  - [x] Подзадача 1.4.2 Акторы: mentions, relations
- [x] Задача 1.5 Механики мок-LLM (2025-12-06: стабильные заглушки summary/bullets/actors/events/domains)
  - [x] Подзадача 1.5.1 Заглушки summary/bullets/actors/events/domains для стабильного UI
- [x] Задача 1.6 Тесты (мок-уровень) (2025-12-06: юнит + API, pytest green)
  - [x] Подзадача 1.6.1 Юнит: GraphManager, EventExtractionService, EmbeddingService, NERService, ClusteringService (базовый кейс)
  - [x] Подзадача 1.6.2 Интеграция API: stories/news/actors/events/graph
  - [x] Подзадача 1.6.3 pytest прогон успешен
- [ ] Задача 1.A Общий редизайн/уплотнение UI (замечание)
  - [ ] Подзадача 1.A.1 Уменьшить размеры заголовков, кнопок, отступов (минималистичный вид)
  - [ ] Подзадача 1.A.2 Пересмотреть веса/цвета вспомогательных элементов, освободить место под данные в панелях
  - [ ] Подзадача 1.A.3 Проверить адаптивность и сохранение состояний после редизайна

## Этап 2. Подмена заглушек реальной работой LLM на мок-данных
- [x] Задача 2.0 Архитектура AI-сервисов/конфигурации (2025-12-06: реестр, профили, UI)
  - [x] Подзадача 2.0.1 Конфиг сервисов и LLM-профилей в JSON (+ пример) (2025-12-06)
  - [x] Подзадача 2.0.2 ServiceRegistry + регистрация модулей (начать с Summary+NER) (2025-12-06)
  - [x] Подзадача 2.0.3 Хот-релоад конфигов без рестарта (перечтение/кэш) (2025-12-06)
  - [x] Подзадача 2.0.4 API: GET/PUT `/api/llm/services` + привязка профилей, dev invoke (2025-12-06)
  - [x] Подзадача 2.0.5 UI модалка: автоген по сервисам/профилям, автоподстановка параметров, PUT профиля (2025-12-06)
- [x] Задача 2.1 Подготовка LLM-интеграции (2025-12-06: Gemini ключ/env, кэш, сервис обновлён)
  - [x] Подзадача 2.1.1 Определить провайдера/модель, лимиты, ключи, env-переменные (Gemini 2.5, `.env` с ключом)
  - [x] Подзадача 2.1.2 Добавить конфиги/секреты (без хардкода), кэширование результатов (`config/gemini.env.example`, file cache)
  - [x] Подзадача 2.1.3 Обновить `LLMService` (реальные вызовы + мок-режим) (Gemini SDK + fallback)
  - [x] Подзадача 2.1.4 Тесты: контрактные с моками ответов (стаб клиент) (`tests/test_llm_api.py`)
- [ ] Задача 2.2 Подключение генерации summary/bullets
  - [x] Подзадача 2.2.1 Бэкенд: маршруты/сервисы вызывают LLM, кэшируют (`/api/llm/generate`, file cache)
  - [x] Подзадача 2.2.2 Фронт: отображение загрузки/ошибки/ретрай (автозапуск summary/bullets без кнопок, статус Loading/Cached/Done/Error, локальный кэш)
  - [x] Подзадача 2.2.3 Тесты: unit + интеграция API (`tests/test_llm_api.py`)
  - [x] Подзадача 2.2.4 Пользовательская проверка: показать историю с новыми summary/bullets, подтвердить (подтверждено пользователем)
- [ ] Задача 2.3 Подключение NER/actors через LLM (или модель)
  - [x] Подзадача 2.3.1 Обогащение новостей акторами, обновление графа (эндпоинт `/api/news/{id}/actors/refresh`, ensure_actor/add_mention, LLM actors)
  - [x] Подзадача 2.3.2 Тесты: unit на NER pipeline, интеграция API actors/mentions (`tests/test_llm_actors_api.py`, мок)
  - [ ] Подзадача 2.3.3 Пользовательская проверка: карточка актора/mentions, подтвердить (в процессе: акторы LLM обновляют новости/истории/граф)
- [ ] Задача 2.4 Подключение событий (EventExtraction) через LLM
  - [ ] Подзадача 2.4.1 Подсказки/парсинг, фолбэк на детерминированную логику
  - [ ] Подзадача 2.4.2 Тесты: unit + интеграция `/api/stories/{id}/events`
  - [ ] Подзадача 2.4.3 Пользовательская проверка: таймлайн с LLM-ивентами, подтвердить
- [ ] Задача 2.5 Подключение доменов/категорий через LLM
  - [ ] Подзадача 2.5.1 Обогащение news/story доменами, отображение в UI
  - [ ] Подзадача 2.5.2 Тесты: unit + интеграция API
  - [ ] Подзадача 2.5.3 Пользовательская проверка: домены в списке/карточке, подтвердить
- [ ] Задача 2.6 UI/UX отказоустойчивость
  - [ ] Подзадача 2.6.1 Спиннеры/ретраи/деградация на ошибках LLM
  - [ ] Подзадача 2.6.2 Тесты: e2e/ручной чек-лист
  - [ ] Подзадача 2.6.3 Пользовательская проверка: сценарий с искусственной ошибкой, подтвердить

## Этап 3. Модуль сбора и нормализации новостей
- [ ] Задача 3.1 Проектирование ingestion
  - [ ] Подзадача 3.1.1 Форматы сырого/нормализованного (docs + схемы)
  - [ ] Подзадача 3.1.2 Очередь/батчинг, ретраи, логирование
  - [ ] Подзадача 3.1.3 Пользовательская проверка: согласовать схемы
- [ ] Задача 3.2 Коннектор RSS (минимум один)
  - [ ] Подзадача 3.2.1 Реализация fetch + парсинг + ретраи
  - [ ] Подзадача 3.2.2 Тесты: юнит парсеров, интеграция коннектора (моки)
  - [ ] Подзадача 3.2.3 Пользовательская проверка: прогон на тестовом feed, подтвердить
- [ ] Задача 3.3 Нормализация + дедуп + обогащение
  - [ ] Подзадача 3.3.1 normalize_raw_item → News, дедуп по url/title/хэшу
  - [ ] Подзадача 3.3.2 Обогащение embeddings/NER/events (используя текущее LLM/моки)
  - [ ] Подзадача 3.3.3 Тесты: unit на дедуп/нормализацию, интеграция с graph_manager
  - [ ] Подзадача 3.3.4 Пользовательская проверка: выборочный просмотр нормализованных записей
- [ ] Задача 3.4 E2E ingest → normalize → graph update
  - [ ] Подзадача 3.4.1 Сбор тестового батча, загрузка в граф, ререндер UI
  - [ ] Подзадача 3.4.2 Тесты: e2e сценарий (скрипт/pytest)
  - [ ] Подзадача 3.4.3 Пользовательская приемка: показать обновленный UI, подтвердить

## Инструкции по обновлению
- При выполнении задачи меняйте `[ ]` → `[x]` и добавляйте краткий комментарий `(дата: что сделано)`.
- Не удаляйте и не перефразируйте существующие пункты без согласования.
- Если добавляются новые подзадачи, формулируйте их кратко и измеримо.

