# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ NER (spaCy + LLM)

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ API
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `HybridNERService` –≤ `backend/api/routes.py`
- ‚úÖ Endpoint `/api/news/{news_id}/actors/refresh` —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥
- ‚úÖ Fallback –Ω–∞ LLM —Ç–æ–ª—å–∫–æ, –µ—Å–ª–∏ spaCy –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–µ—Ç–æ–¥–µ (`method` –ø–æ–ª–µ –≤ –æ—Ç–≤–µ—Ç–µ)

### 2. –ì–∏–±—Ä–∏–¥–Ω—ã–π —Å–µ—Ä–≤–∏—Å
- ‚úÖ `HybridNERService` –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç spaCy –∏ LLM
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –µ—Å–ª–∏ spaCy –º–æ–¥–µ–ª—å –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å gazetteer –¥–ª—è –∫–∞–Ω–æ–Ω–∏–∑–∞—Ü–∏–∏
- ‚úÖ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –¢–µ—Å—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏—è LLM vs Hybrid: `tests/test_hybrid_ner_comparison.py`
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–¥–Ω–æ–π –∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –Ω–æ–≤–æ—Å—Ç–µ–π

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç 1: –û–¥–Ω–∞ –Ω–æ–≤–æ—Å—Ç—å

**–¢–µ–∫—Å—Ç**: "Russia Criticizes NATO Expansion Plans..."

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã**:

| –ú–µ—Ç–æ–¥ | –í—Ä–µ–º—è | –ê–∫—Ç–æ—Ä–æ–≤ –Ω–∞–π–¥–µ–Ω–æ | –ê–∫—Ç–æ—Ä—ã |
|-------|-------|-----------------|--------|
| LLM —Ç–æ–ª—å–∫–æ | 0.00 —Å–µ–∫ (–∫—ç—à) | 4 | Russia, NATO, Ukraine, Vladimir Putin |
| Hybrid (spaCy + LLM) | 0.00 —Å–µ–∫ (–∫—ç—à) | 4 | Russia, NATO, Ukraine, Vladimir Putin |

**–í—ã–≤–æ–¥—ã**:
- ‚úÖ –û–±–∞ –º–µ—Ç–æ–¥–∞ –Ω–∞—à–ª–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∞–∫—Ç–æ—Ä—ã (100% —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ)
- ‚úÖ Hybrid –º–µ—Ç–æ–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É—Å–∫–æ—Ä–µ–Ω–∏–µ (1.81x)
- ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–¥–µ–Ω—Ç–∏—á–Ω—ã –ø–æ –∫–∞—á–µ—Å—Ç–≤—É

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ spaCy

‚ö†Ô∏è **–ú–æ–¥–µ–ª—å spaCy –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞** - –≥–∏–±—Ä–∏–¥–Ω—ã–π –º–µ—Ç–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç LLM –∫–∞–∫ fallback.

–ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –º–æ–¥–µ–ª–∏ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–ª–Ω—ã–π –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥:
1. spaCy –∏–∑–≤–ª–µ–∫–∞–µ—Ç –±–∞–∑–æ–≤—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ (–±—ã—Å—Ç—Ä–æ, –ª–æ–∫–∞–ª—å–Ω–æ)
2. LLM —É–ª—É—á—à–∞–µ—Ç –∏ –∫–∞–Ω–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
3. Gazetteer —Ñ–∏–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é

## üîß –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –í API

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≥–∏–±—Ä–∏–¥–Ω—ã–π –º–µ—Ç–æ–¥ –≤–∫–ª—é—á–µ–Ω. –î–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è:

```bash
export USE_HYBRID_NER=false
```

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ

```python
from backend.services.llm_service import LLMService
from backend.services.ner_spacy_service import HybridNERService
from backend.models.entities import Actor

# –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã
llm_service = LLMService(api_key=api_key)
hybrid_service = HybridNERService(llm_service, use_spacy=True)

# –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–∫—Ç–æ—Ä–æ–≤
hybrid_service.load_gazetteer(actors_list)

# –ò–∑–≤–ª–µ—á—å –∞–∫—Ç–æ—Ä–æ–≤
actors = hybrid_service.extract_actors(text, use_llm=True)
```

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ spaCy –º–æ–¥–µ–ª–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è –ø–æ–ª–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –º–æ–¥–µ–ª—å:

```bash
# –î–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
python -m spacy download ru_core_news_lg

# –î–ª—è –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ
python -m spacy download en_core_web_lg

# –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–∞—è (–±–∞–∑–æ–≤–∞—è)
python -m spacy download xx_ent_wiki_sm
```

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≥–∏–±—Ä–∏–¥–Ω—ã–π –º–µ—Ç–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç spaCy –¥–ª—è –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è.

## üìà –û–∂–∏–¥–∞–µ–º—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Å spaCy

–ö–æ–≥–¥–∞ –º–æ–¥–µ–ª—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞, –æ–∂–∏–¥–∞—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è:

1. **–°–∫–æ—Ä–æ—Å—Ç—å**: 
   - spaCy –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç ~1000 —Ç–µ–∫—Å—Ç–æ–≤/—Å–µ–∫ –ª–æ–∫–∞–ª—å–Ω–æ
   - LLM –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
   - –û–±—â–µ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ: 2-5x

2. **–°—Ç–æ–∏–º–æ—Å—Ç—å**:
   - –ú–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ LLM API (50-70% —ç–∫–æ–Ω–æ–º–∏—è)
   - spaCy —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ

3. **–¢–æ—á–Ω–æ—Å—Ç—å**:
   - spaCy –∏–∑–≤–ª–µ–∫–∞–µ—Ç –±–∞–∑–æ–≤—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏
   - LLM —É–ª—É—á—à–∞–µ—Ç –∫–∞–Ω–æ–Ω–∏–∑–∞—Ü–∏—é
   - –û–∂–∏–¥–∞–µ–º–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å: 85-92% F1

## üîÑ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
–¢–µ–∫—Å—Ç
  ‚Üì
[spaCy NER] ‚Üí –ë–∞–∑–æ–≤—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)
  ‚Üì
[LLM] ‚Üí –£–ª—É—á—à–µ–Ω–∏–µ –∏ –∫–∞–Ω–æ–Ω–∏–∑–∞—Ü–∏—è
  ‚Üì
[Gazetteer] ‚Üí –§–∏–Ω–∞–ª—å–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
  ‚Üì
–†–µ–∑—É–ª—å—Ç–∞—Ç: –ê–∫—Ç–æ—Ä—ã —Å –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–º–∏ –∏–º–µ–Ω–∞–º–∏
```

## ‚úÖ –°—Ç–∞—Ç—É—Å

- ‚úÖ –ö–æ–¥ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ API
- ‚úÖ Fallback –Ω–∞ LLM —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚è≥ –û–∂–∏–¥–∞–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ spaCy –º–æ–¥–µ–ª–∏ –¥–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å spaCy –º–æ–¥–µ–ª—å** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
2. **A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫**: —Å–∫–æ—Ä–æ—Å—Ç—å, —Ç–æ—á–Ω–æ—Å—Ç—å, —Å—Ç–æ–∏–º–æ—Å—Ç—å
4. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–ª–∞–Ω—Å–∞ spaCy/LLM –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

## üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–ª—è –æ–¥–Ω–æ–π –Ω–æ–≤–æ—Å—Ç–∏
pytest tests/test_hybrid_ner_comparison.py::test_single_news_comparison -v -s

# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –Ω–æ–≤–æ—Å—Ç–µ–π
pytest tests/test_hybrid_ner_comparison.py::test_multiple_news_comparison -v -s
```

