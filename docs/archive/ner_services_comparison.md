# Сравнение NER сервисов и рекомендации по интеграции

## Обзор доступных решений

### 1. **spaCy** (рекомендуется для начала)
**Тип**: Библиотека Python  
**Плюсы**:
- ✅ Бесплатная, open-source
- ✅ Быстрая локальная обработка
- ✅ Поддержка многоязычности (включая русский с моделью `ru_core_news_lg`)
- ✅ Entity Linking (канонизация через знания базы)
- ✅ Можно обучать кастомные модели
- ✅ Хорошая интеграция с Python

**Минусы**:
- ⚠️ Требует установки моделей (~500MB для русской модели)
- ⚠️ Канонизация требует дополнительной настройки
- ⚠️ Для лучшей точности нужна fine-tuning

**Стоимость**: Бесплатно  
**Установка**: `pip install spacy && python -m spacy download ru_core_news_lg`

---

### 2. **Natasha** (для русского языка)
**Тип**: Библиотека Python  
**Плюсы**:
- ✅ Специализирована на русском языке
- ✅ Встроенная нормализация русских имен
- ✅ Работает с падежами и склонениями
- ✅ Бесплатная

**Минусы**:
- ⚠️ Только русский язык
- ⚠️ Менее гибкая, чем spaCy
- ⚠️ Ограниченная поддержка английского

**Стоимость**: Бесплатно  
**Установка**: `pip install natasha`

---

### 3. **Google Cloud Natural Language API**
**Тип**: Облачный API  
**Плюсы**:
- ✅ Высокая точность
- ✅ Поддержка множества языков
- ✅ Entity Linking (автоматическая канонизация)
- ✅ Нет необходимости в локальных моделях
- ✅ Уже используете Gemini API

**Минусы**:
- ⚠️ Платный ($1.50 за 1000 запросов после бесплатного лимита)
- ⚠️ Зависимость от интернета
- ⚠️ Rate limits
- ⚠️ Задержки сети

**Стоимость**: $1.50 за 1000 запросов  
**API**: `google.cloud.language`

---

### 4. **Azure Text Analytics / Language Service**
**Тип**: Облачный API  
**Плюсы**:
- ✅ Высокая точность
- ✅ Entity Linking
- ✅ Многоязычность
- ✅ Кастомные модели

**Минусы**:
- ⚠️ Платный
- ⚠️ Зависимость от Azure

**Стоимость**: ~$1 за 1000 транзакций

---

### 5. **Pullenti** (коммерческое)
**Тип**: Коммерческое решение  
**Плюсы**:
- ✅ Высокая точность для русского языка
- ✅ Глубокая канонизация

**Минусы**:
- ⚠️ Коммерческая лицензия
- ⚠️ Ограниченная информация о ценах

---

## Рекомендуемая стратегия: Гибридный подход

### Вариант 1: spaCy + LLM (рекомендуется для MVP)

**Архитектура**:
1. **spaCy** - первичное извлечение (быстро, локально)
2. **LLM (Gemini)** - улучшение и канонизация
3. **NERService с gazetteer** - финальная канонизация через известные акторы

**Преимущества**:
- ✅ Высокая скорость (spaCy быстрее LLM)
- ✅ Снижение затрат на API
- ✅ Локальная обработка базовых случаев
- ✅ LLM используется только для сложных случаев

**Пример workflow**:
```
Текст → spaCy NER → Базовые сущности
      ↓
   LLM (только если нужна канонизация) → Канонические имена
      ↓
   Gazetteer matching → Финалная нормализация
```

---

### Вариант 2: Только spaCy с Entity Linking

**Когда использовать**:
- Много текстов, нужно обрабатывать быстро
- Ограниченный бюджет на API
- Основная задача - извлечение, канонизация через gazetteer

**Недостатки**:
- ⚠️ Меньшая точность канонизации чем у LLM
- ⚠️ Требует настройки gazetteer

---

### Вариант 3: LLM + spaCy для валидации

**Когда использовать**:
- Нужна максимальная точность
- LLM - основной метод
- spaCy - для валидации и дополнения

---

## Рекомендация для вашего проекта

Учитывая, что у вас уже есть:
- ✅ LLM сервис (Gemini) с хорошими результатами (89% F1)
- ✅ NERService с gazetteer
- ✅ Система канонизации акторов

**Рекомендуемый план**:

### Этап 1: Интеграция spaCy как дополнение к LLM
- Использовать spaCy для первичного извлечения
- LLM для канонизации и сложных случаев
- Снизить стоимость API на 50-70%

### Этап 2: Улучшение канонизации
- Использовать Entity Linking из spaCy (если доступно)
- Интегрировать с gazetteer для лучшей нормализации

### Этап 3: Оптимизация
- A/B тестирование: только spaCy vs гибрид
- Выбор оптимального баланса скорости/точности/стоимости

