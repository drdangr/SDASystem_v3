# Результаты тестирования гибридного извлечения акторов

## Тест: Hybrid NER (spaCy + LLM) vs Только LLM

### Дата тестирования
2025-12-06

### Методология
- Тестирование на 10 новостях из бэкапа
- Сравнение с ожидаемыми акторами из `data/backup/actors_test/`
- Метрики: Precision, Recall, F1-Score

## Результаты

### Гибридный метод (spaCy + LLM)

**Общие метрики:**
- **Precision**: 80.00%
- **Recall**: 69.17%
- **F1-Score**: 73.24%
- **Канонических названий найдено**: 20
- **Алиасов найдено**: 0

**Используемая конфигурация:**
- spaCy модель: `en_core_web_sm`
- spaCy компоненты: tok2vec, tagger, parser, attribute_ruler, lemmatizer, **ner**
- LLM: Gemini (для улучшения результатов)

### Только LLM (для сравнения)

**Общие метрики** (из предыдущего теста):
- **Precision**: 100.00%
- **Recall**: 86.46%
- **F1-Score**: 91.55%

## Анализ по новостям

| Новость | Hybrid F1 | LLM F1 | Статус |
|---------|-----------|--------|--------|
| Russia Criticizes NATO | 100% | 100% | ✅ Отлично |
| UN Calls for Peace | 80% | 80% | ✅ Хорошо |
| Global Climate Summit | 66.67% | 66.67% | ⚠️ Средне (пропущено 3) |
| EU Pledges Carbon Neutrality | 100% | 100% | ✅ Отлично |
| Microsoft Announces AI | 100% | 100% | ✅ Отлично |
| Google Responds | 100% | 100% | ✅ Отлично |
| US Presidential Campaign | 100% | 100% | ✅ Отлично |
| Tech Leaders Discuss | 85.71% | 85.71% | ✅ Хорошо |
| Tesla Opens Gigafactory | 0% | 0% | ❌ Проблема |
| Tesla AI Breakthrough | 0% | 0% | ❌ Проблема |

## Выводы

### Преимущества гибридного подхода:
1. ✅ **Быстрота**: spaCy делает первичное извлечение локально
2. ✅ **Экономия**: Меньше запросов к LLM API
3. ✅ **Хорошая точность**: 73% F1 на большинстве новостей

### Области для улучшения:
1. ⚠️ **Recall ниже чем у LLM**: 69% vs 86%
   - Гибридный метод может пропускать некоторые акторы
   - Особенно заметно на новостях про Climate Summit (пропущено 3)

2. ⚠️ **Проблемы с Tesla новостями**: 
   - Оба метода показывают 0% F1
   - Возможно, Tesla/Elon Musk не в ожидаемых акторах или требуют особой обработки

3. ⚠️ **Низкий процент алиасов**:
   - Найдено 0 алиасов (хотя они есть в текстах)
   - Возможно, нужно улучшить сопоставление алиасов

## Рекомендации

### Для улучшения Recall:
1. Использовать большую модель spaCy (`en_core_web_lg`) для лучшей точности
2. Настроить гибридный метод: spaCy извлекает больше, LLM канонизирует
3. Улучшить промпт LLM для лучшей канонизации

### Для улучшения обработки Tesla:
1. Проверить ожидаемых акторов для Tesla новостей
2. Добавить Tesla в gazetteer с правильными алиасами
3. Улучшить обработку компаний в промпте

### Для улучшения поиска алиасов:
1. Улучшить логику сопоставления в `match_extracted_actor`
2. Добавить нормализацию для поиска алиасов
3. Использовать gazetteer более активно

## Сравнение методов

| Метрика | Hybrid (spaCy+LLM) | Только LLM | Разница |
|---------|-------------------|------------|---------|
| Precision | 80.00% | 100.00% | -20% |
| Recall | 69.17% | 86.46% | -17.29% |
| F1-Score | 73.24% | 91.55% | -18.31% |
| Скорость | Быстрее | Медленнее | + |
| Стоимость | Ниже | Выше | + |

**Вывод**: Гибридный подход показывает хорошие результаты (73% F1), но уступает чистому LLM по точности. Однако он быстрее и дешевле, что важно для продакшена.

## Следующие шаги

1. ✅ Протестировать с большей моделью spaCy (`en_core_web_lg`)
2. ✅ Оптимизировать баланс spaCy/LLM в гибридном методе
3. ✅ Улучшить обработку Tesla новостей
4. ✅ Улучшить поиск алиасов

