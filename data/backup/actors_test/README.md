# Бэкап данных для тестирования извлечения акторов

Эта папка содержит бэкапы ожидаемых акторов для каждой новости. Используется для тестирования качества работы LLM-сервиса извлечения акторов.

## Структура

- `_metadata.json` - метаданные о всех новостях и количестве ожидаемых акторов
- `{news_id}.json` - файлы с ожидаемыми акторами для каждой новости

## Формат данных бэкапа

Каждый файл `{news_id}.json` содержит:

```json
{
  "news_id": "news_xxx",
  "news_title": "Заголовок новости",
  "news_text": "Полный текст новости",
  "expected_actors": [
    {
      "id": "actor_xxx",
      "canonical_name": "Каноническое название",
      "actor_type": "person|company|country|organization",
      "aliases": ["Алиас 1", "Алиас 2"],
      "all_mentions": ["Все возможные варианты упоминания"],
      "normalized_names": ["Нормализованные варианты"]
    }
  ],
  "original_mentioned_actors": ["actor_id1", "actor_id2"]
}
```

## Создание/обновление бэкапа

Чтобы создать или обновить бэкап данных, выполните:

```bash
python scripts/create_actors_backup.py
```

Этот скрипт:
1. Загружает все новости из `data/news.json`
2. Загружает всех акторов из `data/actors.json`
3. Для каждой новости создает список ожидаемых акторов на основе поля `mentioned_actors`
4. Сохраняет результаты в папку `data/backup/actors_test/`

## Запуск тестов

Для тестирования извлечения акторов:

```bash
# Полный тест для всех новостей
pytest tests/test_actors_extraction.py::test_actors_extraction_for_all_news -v

# Детальный тест для одной новости (для отладки)
pytest tests/test_actors_extraction.py::test_single_news_detailed -v -s
```

## Критерии проверки

Тест проверяет:

1. **Совпадения** - количество правильно извлеченных акторов
2. **Канонические названия** - использование стандартных имен акторов
3. **Косвенные упоминания** - выявление акторов через алиасы (например, "Путин" -> "Vladimir Putin")
4. **Алиасы** - нахождение неканонических названий в текстах

## Метрики

Тест вычисляет следующие метрики:

- **Precision** - точность (сколько извлеченных акторов правильные)
- **Recall** - полнота (сколько ожидаемых акторов найдено)
- **F1-Score** - среднее гармоническое precision и recall

## Важно

⚠️ Для работы с реальным LLM необходимо установить API ключ:

```bash
export GEMINI_API_KEY="your-api-key"
```

Без API ключа тест будет использовать mock данные и покажет 0% точности.

